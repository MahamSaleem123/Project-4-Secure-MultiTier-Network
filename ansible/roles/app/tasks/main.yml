- name: Install Python
  apt:
    name: python3
    state: present
    update_cache: yes

- name: Copy simple app
  copy:
    dest: /opt/app.py
    mode: "0755"
    content: |
      from http.server import BaseHTTPRequestHandler, HTTPServer

      class Handler(BaseHTTPRequestHandler):
          def do_GET(self):
              if self.path == "/health":
                  self.send_response(200)
                  self.end_headers()
                  self.wfile.write(b"OK")
              else:
                  self.send_response(200)
                  self.end_headers()
                  self.wfile.write(b"Hello from App Tier")

      HTTPServer(("0.0.0.0", 8080), Handler).serve_forever()

- name: Run app
  shell: nohup python3 /opt/app.py &
